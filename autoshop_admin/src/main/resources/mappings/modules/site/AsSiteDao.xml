<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.zhilai.master.modules.site.dao.AsSiteDao">
 	<resultMap type="com.zhilai.master.modules.site.entity.AsSite" id="AsSiteResultMap">
 		<id property="logid" column="logid"/>
 		<result property="tree_id" column="tree_id" />
 		<result property="tree_name" column="tree_name" />
 		<result property="owner_id" column="owner_id" />
 		<result property="owner_name" column="owner_name" />
 		<result property="site_id" column="site_id" />
 		<result property="site_code" column="site_code" />
 		<result property="site_name" column="site_name" />
 		<result property="fullname" column="fullname" />
 		<result property="auth_name" column="auth_name" />
 		<result property="auth_id" column="auth_id" />
 		<result property="cabinet_type" column="cabinet_type" />
 		<result property="cabinet_type_name" column="cabinet_type_name" />
 		<result property="latitude" column="latitude" />
 		<result property="longitude" column="longitude" />
 		<result property="addr" column="addr" />
 		<result property="searcher" column="searcher" />
 		<result property="site_state" column="site_state" />
 		<result property="service_type" column="service_type" />
 		<result property="state_time" column="state_time" />
 		<result property="comm_type" column="comm_type" />
 		<result property="is_replenishment" column="is_replenishment" />
 		<result property="boxlack_num" column="boxlack_num" />
 		<result property="prolack_num" column="prolack_num" />
 		<result property="warn_type" column="warn_type" />
 		<result property="warn_cont" column="warn_cont" />
 		<result property="warn_time" column="warn_time" />
 		<result property="cur_temperature" column="cur_temperature" />
 		<result property="config_stemperature" column="config_stemperature" />
 		<result property="config_etemperature" column="config_etemperature" />
 		<result property="temperature_state" column="temperature_state" />
 		<result property="down_state" column="down_state" />
 		<result property="down_time" column="down_time" />
 		<result property="create_time" column="create_time" />
 		<result property="warn_state" column="warn_state" />
 	</resultMap>
    
	<select id="get" resultMap="AsSiteResultMap">
		SELECT  *  FROM as_site WHERE  site_id = #{site_id}
	</select>
	<select id="findBySiteId" parameterType="String" resultMap="AsSiteResultMap">
		select * from as_site  where site_id=#{site_id} order by
		create_time DESC
	</select>
	
	<select id="findList" resultMap="AsSiteResultMap">
		SELECT * FROM as_site where 1=1
		<if test="site_id != null and site_id != ''">
			AND site_id = #{site_id}
		</if>
		<if test="corp_id != null and corp_id != ''">
			AND owner_id = #{corp_id}
		</if>
		<if test="cabinet_type != null and cabinet_type != ''">
			AND cabinet_type = #{cabinet_type}
		</if>
		<if test="cabinet_type_name != null and cabinet_type_name != ''">
			AND cabinet_type_name = #{cabinet_type_name}
		</if>
		<if test="tree_id != null and tree_id != ''">
			AND tree_id  LIKE CONCAT('',#{tree_id}, '%')
		</if>
		<if test="site_name != null and site_name != ''">
			AND site_name  LIKE CONCAT('%',#{site_name}, '%')
		</if>
		<if test="site_state != null and site_state != ''">
			AND site_state = #{site_state}
		</if>
		<if test="warn_type != null and warn_type != ''">
			AND warn_type != '01'
		</if>
		<if test="create_time != null and create_time != '' ">
			AND create_time  <![CDATA[>= ]]>  #{create_time}
		</if>
		ORDER BY create_time desc
	</select>
	
	<select id="findWarnList" resultMap="AsSiteResultMap">
		SELECT  *  FROM as_site where warn_type != '01' 
		<if test="corp_id != null and corp_id != ''">
			AND owner_id = #{corp_id}
		</if>
		ORDER BY warn_time desc limit 0,7 
	</select>
	
	<select id="findAllList" resultMap="AsSiteResultMap">
		SELECT  *  FROM as_site ORDER BY create_time 
	</select>
	
	<select id="findListOnline" resultMap="AsSiteResultMap">
		select * from as_site where site_id in (select site_id from as_site_state where refresh_state='1') and site_state='0'
	</select>
	
	<insert id="insert">
			INSERT INTO as_site(logid,tree_id,tree_name,owner_id,owner_name,site_id,site_code,site_name,fullname,auth_name,
			auth_id,cabinet_type,cabinet_type_name,latitude,longitude,addr,searcher,site_state,service_type,state_time,comm_type,is_replenishment,boxlack_num,
			prolack_num,warn_type,warn_cont,warn_time,cur_temperature,config_stemperature,config_etemperature,temperature_state,
			down_state,down_time,create_time,warn_state)
			values(#{logid},#{tree_id},#{tree_name},#{owner_id},#{owner_name},#{site_id},#{site_code},#{site_name},#{fullname},#{auth_name},
			#{auth_id},#{cabinet_type},#{cabinet_type_name},#{latitude},#{longitude},#{addr},#{searcher},#{site_state},#{service_type},#{state_time},#{comm_type},#{is_replenishment},#{boxlack_num},
			#{prolack_num},#{warn_type},#{warn_cont},#{warn_time},#{cur_temperature},#{config_stemperature},#{config_etemperature},#{temperature_state},
			#{down_state},#{down_time},#{create_time},#{warn_state})
	</insert>
	<update id="update">
		update as_site set tree_id=#{tree_id},tree_name=#{tree_name},owner_id=#{owner_id},owner_name=#{owner_name},site_id=#{site_id},site_code=#{site_code},
		site_name=#{site_name},fullname=#{fullname},auth_name=#{auth_name},auth_id=#{auth_id},cabinet_type=#{cabinet_type},cabinet_type_name=#{cabinet_type_name},latitude=#{latitude},longitude=#{longitude},addr=#{addr},
		searcher=#{searcher},site_state=#{site_state},service_type=#{service_type},state_time=#{state_time},comm_type=#{comm_type},is_replenishment=#{is_replenishment},boxlack_num=#{boxlack_num},
		prolack_num=#{prolack_num},warn_type=#{warn_type},warn_cont=#{warn_cont},warn_time=#{warn_time},cur_temperature=#{cur_temperature},config_stemperature=#{config_stemperature},config_etemperature=#{config_etemperature},
		temperature_state=#{temperature_state},down_state=#{down_state},down_time=#{down_time},create_time=#{create_time},warn_state=#{warn_state}	
		where site_id=#{site_id}
	</update>
	
	<update id="updateSiteState">
		update as_site set
		site_state=#{site_state} 
		WHERE
		site_id=#{site_id}
	</update>
	
	<delete id="delete">
		delete from as_site where site_id = #{site_id}
	</delete>
	
</mapper>