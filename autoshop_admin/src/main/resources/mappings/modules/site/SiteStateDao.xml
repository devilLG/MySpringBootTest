<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.zhilai.master.modules.site.dao.SiteStateDao">
 	<resultMap type="com.zhilai.master.modules.site.entity.SiteState" id="SiteStateResultMap">
 		<id property="logid" column="logid" />
		<result property="site_id" column="site_id" />
		<result property="site_name" column="site_name"/>
		<result property="box_all" column="box_all"/>
		<result property="box_empty" column="box_empty"/>
		<result property="box_short" column="box_short"/>
		<result property="box_damage" column="box_damage"/>
		<result property="refresh_state" column="refresh_state"/>
		<result property="refresh_time" column="refresh_time"/>
		<result property="refresh_num" column="refresh_num"/>
		<result property="compute_time" column="compute_time"/>
		<result property="compute_state" column="compute_state"/>
		<result property="owner_id" column="owner_id"/>
 	</resultMap>
 	
 	<select id="get" resultMap="SiteStateResultMap">
		SELECT 
			*
		FROM as_site_state a
		WHERE a.logid = #{logid}
	</select>
	
	<select id="findList" resultMap="SiteStateResultMap">
		SELECT 
			*
		FROM as_site_state a WHERE 1=1 
		<if test="site_id != null and site_id != ''">
			AND a.site_id like 
					<if test="dbName == 'oracle'">'%'||#{site_id}||'%'</if>
					<if test="dbName == 'mssql'">'%'+#{site_id}+'%'</if>
					<if test="dbName == 'mysql'">CONCAT('%', #{site_id}, '%')</if>
		</if>
		<if test="site_name != null and site_name != ''">
			AND a.site_name like 
					<if test="dbName == 'oracle'">'%'||#{site_name}||'%'</if>
					<if test="dbName == 'mssql'">'%'+#{site_name}+'%'</if>
					<if test="dbName == 'mysql'">CONCAT('%', #{site_name}, '%')</if>
		</if>
		<if test="refresh_state != null and refresh_state != ''">
			AND a.refresh_state like 
					<if test="dbName == 'oracle'">'%'||#{refresh_state}||'%'</if>
					<if test="dbName == 'mssql'">'%'+#{refresh_state}+'%'</if>
					<if test="dbName == 'mysql'">CONCAT('%', #{refresh_state}, '%')</if>
		</if>
		<if test="logid != null and logid != ''">
			AND a.logid = #{logid}
		</if>
		<if test="owner_id != null and owner_id != ''">
			AND a.owner_id = #{owner_id}
		</if>
		ORDER BY a.compute_state AND a.box_damage DESC
	</select>
	
	<select id="findByRefreshTime" parameterType="String" resultMap="SiteStateResultMap">
		select * from as_site_state t where refresh_time <![CDATA[<]]>#{refresh_time} and refresh_state='0'
		order by refresh_time DESC
	</select>
	<select id="findBySiteId" parameterType="String" resultMap="SiteStateResultMap">
		select * from as_site_state where site_id=#{site_id} order by
		refresh_time DESC
	</select>
	
	<update id="updateRefresh">
		update as_site_state t set
		refresh_time=#{refresh_time},refresh_state=#{refresh_state},refresh_num=#{refresh_num}
		where 1=1
		<if test="logid != null and logid != '' ">
			AND t.logid = #{logid}
		</if>
		<if test="site_id != null and site_id != '' ">
			AND t.site_id = #{site_id}
		</if>
	</update>
	
	<insert id="insert">
		INSERT INTO
		as_site_state(logid,site_id,site_name,box_all,box_empty,box_short,box_damage,refresh_state,refresh_time,refresh_num,compute_time
		,compute_state,owner_id)
		VALUES(#{logid},#{site_id},#{site_name},#{box_all},#{box_empty},#{box_short},#{box_damage},#{refresh_state},#{refresh_time}
		,#{refresh_num},#{compute_time},#{compute_state},#{owner_id});
	</insert>
	
	<update id="update">
		update as_site_state set
		site_id=#{site_id},site_name=#{site_name},box_all=#{box_all}, box_empty=#{box_empty},box_short=#{box_short}
		,box_damage=#{box_damage},refresh_state=#{refresh_state},refresh_time=#{refresh_time},refresh_num=#{refresh_num},compute_time=#{compute_time},compute_state=#{compute_state}
		,owner_id=#{owner_id}
		where logid =#{logid}
	</update>
	
	<delete id="delete">
		delete from as_site_state where logid=#{logid}
	</delete>
	<delete id="deleteBysid">
		delete from as_site_state where site_id = #{site_id}
	</delete>
	
 </mapper> 
 	
