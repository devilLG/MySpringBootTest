<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.zhilai.master.modules.person.dao.SiteControlLogDao">
 	<resultMap type="com.zhilai.master.modules.person.entity.SiteControlLog" id="SiteControlLogResultMap">
 		<id property="logid" column="logid" />
		<result property="site_id" column="site_id" />
		<result property="site_name" column="site_name"/>
		<result property="trade_code" column="trade_code"/>
		<result property="trade_name" column="trade_name"/>
		<result property="issued_key" column="issued_key"/>
		<result property="cur_state" column="cur_state"/>
		<result property="create_time" column="create_time"/>
		<result property="frist_attr" column="frist_attr"/>
		<result property="corp_id" column="corp_id"/>
 	</resultMap>
 	
 	<select id="get" resultMap="SiteControlLogResultMap">
		SELECT 
			*
		FROM as_site_control_log a
		WHERE a.logid = #{logid}
	</select>
	
	<select id="findList" resultMap="SiteControlLogResultMap">
		SELECT 
			*
		FROM as_site_control_log a WHERE 1=1 
		<if test="site_id != null and site_id != ''">
			AND a.site_id like 
					<if test="dbName == 'oracle'">'%'||#{site_id}||'%'</if>
					<if test="dbName == 'mssql'">'%'+#{site_id}+'%'</if>
					<if test="dbName == 'mysql'">CONCAT('%', #{site_id}, '%')</if>
		</if>
		<if test="site_name != null and site_name != ''">
			AND a.site_name like 
					<if test="dbName == 'oracle'">'%'||#{site_name}||'%'</if>
					<if test="dbName == 'mssql'">'%'+#{site_name}+'%'</if>
					<if test="dbName == 'mysql'">CONCAT('%', #{site_name}, '%')</if>
		</if>
		<if test="issued_key != null and issued_key != ''">
			AND a.issued_key like 
					<if test="dbName == 'oracle'">'%'||#{issued_key}||'%'</if>
					<if test="dbName == 'mssql'">'%'+#{issued_key}+'%'</if>
					<if test="dbName == 'mysql'">CONCAT('%', #{issued_key}, '%')</if>
		</if>
		<if test="logid != null and logid != ''">
			AND a.logid = #{logid}
		</if>
		<if test="trade_code != null and trade_code != ''">
			AND a.trade_code = #{trade_code}
		</if>
		and site_id in (
		select site_id from as_site where 1=1
		<if test="corp_id != null and corp_id != ''">
			and owner_id = #{corp_id}
		</if>
		) 
		ORDER BY a.create_time DESC
	</select>
	
	<insert id="insert" >
		insert into
		as_site_control_log(logid,site_id,site_name,trade_code,trade_name,issued_key,cur_state,create_time)values(
		#{logid},#{site_id},#{site_name},#{trade_code},#{trade_name},#{issued_key},#{cur_state},#{create_time})
	</insert>
	
	<delete id="delete">
		delete from as_site_control_log where logid=#{logid}
	</delete>
	
 </mapper> 
 	
