<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.zhilai.master.modules.order.dao.OrderApplyDao">
 	<resultMap type="com.zhilai.master.modules.order.entity.OrderApply" id="orderApplyResultMap">
 		<id property="logid" column="logid" />
		<result property="order_id" column="order_id" />
		<result property="torder_id" column="torder_id" />
		<result property="order_type" column="order_type" />
		<result property="corp_id" column="corp_id" />
		<result property="corp_name" column="corp_name" />
		<result property="site_id" column="site_id" />
		<result property="site_name" column="site_name" />
		<result property="login_id" column="login_id" />
		<result property="login_name" column="login_name" />
		<result property="sale_channel" column="sale_channel" />
		<result property="product_num" column="product_num" />
		<result property="sale_total" column="sale_total" />
		<result property="pay_type" column="pay_type" />
		<result property="pay_state" column="pay_state" />
		<result property="pay_overtime" column="pay_overtime" />
		<result property="fetch_overTime" column="fetch_overTime" />
		<result property="cur_state" column="cur_state" />
		<result property="recovery_type" column="recovery_type" />
		<result property="pass_word" column="pass_word" />
		<result property="encryption_type" column="encryption_type" />
		<result property="slat" column="slat" />
		<result property="state_time" column="state_time" />
		<result property="down_state" column="down_state" />
		<result property="down_time" column="down_time" />
		<result property="create_time" column="create_time" />
		<result property="OutTradeNo" column="out_trade_no" />
		<result property="abnormalType" column="abnormal_type" />
   </resultMap>
   
   <select id="get" resultMap="orderApplyResultMap">
		SELECT 
			*
		FROM as_order_apply a
		WHERE a.logid = #{logid}
	</select>
	
	<select id="findList" resultMap="orderApplyResultMap">
		SELECT 
			*
		FROM as_order_apply a WHERE 1=1 
		<if test="order_id != null and order_id != ''">
			AND a.order_id like 
					<if test="dbName == 'oracle'">'%'||#{order_id}||'%'</if>
					<if test="dbName == 'mssql'">'%'+#{order_id}+'%'</if>
					<if test="dbName == 'mysql'">CONCAT('%', #{order_id}, '%')</if>
		</if>
		<if test="login_name != null and login_name != ''">
			AND a.login_name like 
					<if test="dbName == 'oracle'">'%'||#{login_name}||'%'</if>
					<if test="dbName == 'mssql'">'%'+#{login_name}+'%'</if>
					<if test="dbName == 'mysql'">CONCAT('%', #{login_name}, '%')</if>
		</if>
		<if test="site_id != null and site_id != ''">
			AND a.site_id = #{site_id}
		</if>
		<if test="corp_id != null and corp_id != ''">
			AND a.corp_id = #{corp_id}
		</if>
		<if test="sale_channel != null and sale_channel != ''">
			AND a.sale_channel = #{sale_channel}
		</if>
		<if test="order_type != null and order_type != ''">
			AND a.order_type = #{order_type}
		</if>
		<if test="cur_state != null and cur_state != ''">
			AND a.cur_state = #{cur_state}
		</if>
		<if test="pay_state != null and pay_state != '' and pay_state != '-1'">
			AND a.pay_state = #{pay_state}
		</if>
		<if test="pay_state != null and pay_state != '' and pay_state == '-1'">
			AND a.pay_state in ('01','05')
		</if>
		<if test="beginTime != null and beginTime != '' ">
			and create_time >= CONCAT(#{beginTime},' 00:00:00')
		</if>
		<if test="endTime != null and endTime != '' ">
			and create_time <![CDATA[< ]]>DATE_ADD(CONCAT(#{endTime},' 00:00:00'), INTERVAL 1 DAY) 
		</if>
		<if test="create_time != null and create_time != '' ">
			and create_time like CONCAT(#{create_time}, '%')
		</if>
		ORDER BY a.abnormal_type desc,a.create_time desc
	</select>
	
	<insert id="updateAbnormalType">
		update as_order_apply set abnormal_type=#{abnormalType} where order_id=#{order_id}
	</insert>
	
 </mapper> 
 	
