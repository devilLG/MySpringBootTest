<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.zhilai.master.modules.product.dao.ProductClassifyDao">

	<resultMap type="com.zhilai.master.modules.product.entity.ProductClassify" id="productClassifyResultMap">
		<id property="logid" column="logid" />
		<result property="classify_id" column="classify_id" />
		<result property="classify_name" column="classify_name" />
		<result property="classify_desc" column="classify_desc" />
		<result property="parent_id" column="parent_id" />
		<result property="parent_ids" column="parent_ids" />
		<result property="corp_id" column="corp_id" />
		<result property="corp_name" column="corp_name" />
		<result property="create_time" column="create_time" />
		<result property="level" column="level" />
		<result property="sort_by" column="sort_by" />
		<result property="wechart_image" column="wechart_image" />
		<result property="android_image" column="android_image" />
		<result property="ios_image" column="ios_image" />
		<result property="terminal_image" column="terminal_image" />
	</resultMap>
	
	<select id="get" resultMap="productClassifyResultMap">
		SELECT 
			*
		FROM as_product_classify a
		WHERE a.classify_id = #{classify_id}
	</select>

	<select id="findAll" resultMap="productClassifyResultMap">
		SELECT a.*,(select classify_name FROM as_product_classify b WHERE b.classify_id = a.parent_id )AS parentName FROM as_product_classify a WHERE 1=1 
		<if test="corp_id != null and corp_id != ''">
			AND a.corp_id = #{corp_id}
		</if>
		OR classify_id='1'
		ORDER BY a.sort_by
	</select>
	
	<select id="findChildByParentId" resultMap="productClassifyResultMap">
		select * from as_product_classify where 
			  parent_ids like
					<if test="dbName == 'oracle'">'%'||#{classify_id}||'%'</if>
					<if test="dbName == 'mssql'">'%'+#{classify_id}+'%'</if>
					<if test="dbName == 'mysql'">CONCAT('%', #{classify_id}, '%')</if>
	</select>
	
	<select id="findExist" resultMap="productClassifyResultMap">
		select * from as_product_classify where corp_id=#{corp_id} AND classify_name = #{classify_name}
	</select>
	
	<update id="update">
		update as_product_classify set
		classify_name=#{classify_name},
		classify_desc=#{classify_desc},
		parent_id=#{parent_id},
		corp_id=#{corp_id},
		corp_name=#{corp_name},
		level=#{level},
		sort_by=#{sort_by},
		wechart_image=#{wechart_image},
		android_image=#{android_image},
		ios_image=#{ios_image},
		terminal_image=#{terminal_image}
		where logid=#{logid}
	</update>
	
	<update id="updateSort">
		UPDATE as_product_classify SET 
			sort_by = #{sort_by}
		WHERE logid = #{logid}
	</update>
	
	<insert id="insert">
		insert into as_product_classify(logid,level,sort_by,corp_id,corp_name,classify_id,classify_name,classify_desc,parent_id,parent_ids,create_time,wechart_image,android_image,ios_image,terminal_image)
		VALUES(#{logid},#{level},#{sort_by},#{corp_id},#{corp_name},#{classify_id},#{classify_name},#{classify_desc},#{parent_id},#{parent_ids},#{create_time},#{wechart_image},#{android_image},#{ios_image},#{terminal_image})
	</insert>
	
	<delete id="delete" parameterType="String">
		delete from as_product_classify where classify_id=#{classify_id}
		OR parent_ids LIKE 
					<if test="dbName == 'oracle'">'%,'||#{classify_id}||',%'</if>
					<if test="dbName == 'mssql'">'%,'+#{classify_id}+',%'</if>
					<if test="dbName == 'mysql'">CONCAT('%,', #{classify_id}, ',%')</if>
	</delete>
</mapper>

