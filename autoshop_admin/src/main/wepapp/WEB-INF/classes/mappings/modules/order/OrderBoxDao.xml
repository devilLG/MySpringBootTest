<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.zhilai.master.modules.order.dao.OrderBoxDao">
	<resultMap type="com.zhilai.master.modules.order.entity.OrderBox" id="orderBoxResultMap">
		<id property="logid" column="logid" />
		<result property="probox_id" column="probox_id" />
		<result property="prodetail_id" column="prodetail_id" />
		<result property="corp_id" column="corp_id" />
		<result property="corp_name" column="corp_name" />
		<result property="order_id" column="order_id" />
		<result property="torder_id" column="torder_id" />
		<result property="site_id" column="site_id" />
		<result property="site_name" column="site_name" />
		<result property="box_id" column="box_id" />
		<result property="box_type" column="box_type" />
		<result property="product_id" column="product_id" />
		<result property="product_name" column="product_name" />
		<result property="take_num" column="take_num" />
		<result property="altake_num" column="altake_num" />
		<result property="cur_state" column="cur_state" />
		<result property="state_time" column="state_time" />
		<result property="create_time" column="create_time" />

	</resultMap>

    <select id="get" resultMap="orderBoxResultMap">
		SELECT 
			*
		FROM as_order_box a
		WHERE a.logid = #{logid}
	</select>
	
	<select id="findList" resultMap="orderBoxResultMap">
		SELECT 
			*
		FROM as_order_box a WHERE 1=1 
		<if test="order_id != null and order_id != ''">
			AND a.order_id like 
					<if test="dbName == 'oracle'">'%'||#{order_id}||'%'</if>
					<if test="dbName == 'mssql'">'%'+#{order_id}+'%'</if>
					<if test="dbName == 'mysql'">CONCAT('%', #{order_id}, '%')</if>
		</if>
		<if test="product_id != null and product_id != ''">
			AND a.product_id like 
					<if test="dbName == 'oracle'">'%'||#{product_id}||'%'</if>
					<if test="dbName == 'mssql'">'%'+#{product_id}+'%'</if>
					<if test="dbName == 'mysql'">CONCAT('%', #{product_id}, '%')</if>
		</if>
		<if test="site_id != null and site_id != ''">
			AND a.site_id = #{site_id}
		</if>
		<if test="box_id != null and box_id != ''">
			AND a.box_id = #{box_id}
		</if>
		<if test="cur_state != null and cur_state != ''">
			AND a.cur_state = #{cur_state}
		</if>
		<if test="beginTime != null and beginTime != '' ">
			and state_time >= CONCAT(#{beginTime},' 00:00:00')
		</if>
		<if test="endTime != null and endTime != '' ">
			and state_time <![CDATA[< ]]>DATE_ADD(CONCAT(#{endTime},' 00:00:00'), INTERVAL 1 DAY) 
		</if>
		<if test="corp_id != null and corp_id != ''">
			AND a.corp_id = #{corp_id}
		</if>
		ORDER BY a.state_time DESC
	</select>

	<insert id="insert">
		insert into
		as_order_box(logid,probox_id,prodetail_id,corp_id,corp_name,order_id,torder_id,box_id,box_type,product_id,product_name,take_num,altake_num,cur_state,state_time,create_time)
		values(#{logid},#{probox_id},#{prodetail_id},#{corp_id},#{corp_name},#{order_id},#{torder_id},#{box_id},#{box_type},#{product_id},#{product_name},#{take_num},#{altake_num},#{cur_state},#{state_time},#{create_time})
	</insert>
	
	<insert id="update">
		update as_order_box set torder_id=#{torder_id},box_id=#{box_id},box_type=#{box_type},product_id=#{product_id},product_name=#{product_name},take_num=#{take_num},altake_num=#{altake_num},cur_state=#{cur_state},state_time=#{state_time}
		where logid=#{logid}
	</insert>
	
	<delete id="delete">
	    delete from as_order_box where logid=#{logid}
	</delete>
</mapper>