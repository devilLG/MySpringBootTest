<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.zhilai.master.modules.inventory.dao.BarterOrderDao">
	<resultMap type="com.zhilai.master.modules.inventory.entity.BarterOrder" id="barterOrderResultMap">
		<id property="logid" column="logid" />
		<result property="order_id" column="order_id" />
		<result property="torder_id" column="torder_id" />
		<result property="corp_id" column="corp_id" />
		<result property="corp_name" column="corp_name" />
		<result property="site_id" column="site_id" />
		<result property="site_name" column="site_name" />
		<result property="barter_num" column="barter_num" />
		<result property="barter_box" column="barter_box" />
		<result property="barter_product" column="barter_product" />
		<result property="barter_date" column="barter_date" />
		<result property="barter_id" column="barter_id" />
		<result property="barter_name" column="barter_name" />
		<result property="barter_state" column="barter_state" />
		<result property="state_time" column="state_time" />
		<result property="down_state" column="down_state" />
		<result property="down_time" column="down_time" />
		<result property="create_time" column="create_time" />
		<result property="barter_type" column="barter_type" />
	</resultMap>
	
 	<select id="get" resultMap="barterOrderResultMap">
		SELECT 
			*
		FROM as_barter_order a
		WHERE a.logid = #{logid}
	</select>
	
	<select id="findList" resultMap="barterOrderResultMap">
		SELECT 
			*
		FROM as_barter_order a WHERE 1=1 
		<if test="order_id != null and order_id != ''">
			AND a.order_id like 
					<if test="dbName == 'oracle'">'%'||#{order_id}||'%'</if>
					<if test="dbName == 'mssql'">'%'+#{order_id}+'%'</if>
					<if test="dbName == 'mysql'">CONCAT('%', #{order_id}, '%')</if>
		</if>
		<if test="barter_name != null and barter_name != ''">
			AND a.barter_name like 
					<if test="dbName == 'oracle'">'%'||#{barter_name}||'%'</if>
					<if test="dbName == 'mssql'">'%'+#{barter_name}+'%'</if>
					<if test="dbName == 'mysql'">CONCAT('%', #{barter_name}, '%')</if>
		</if>
		<if test="site_id != null and site_id != ''">
			AND a.site_id = #{site_id}
		</if>
		<if test="corp_id != null and corp_id != ''">
			AND a.corp_id = #{corp_id}
		</if>
		<if test="barter_state != null and barter_state != ''">
			AND a.barter_state = #{barter_state}
		</if>
		<if test="beginTime != null and beginTime != '' ">
			and barter_date >= #{beginTime}
		</if>
		<if test="endTime != null and endTime != '' ">
			and barter_date <![CDATA[< ]]>DATE_ADD(#{endTime}, INTERVAL 1 DAY) 
		</if>
		ORDER BY a.state_time DESC
	</select>
	
		
	<select id="findExist" resultMap="barterOrderResultMap">
		SELECT * FROM as_barter_order a WHERE a.site_id=#{site_id} AND a.barter_state != '2'
	</select>

	<insert id="insert">
		insert into
		as_barter_order(logid,order_id,barter_type,corp_id,corp_name,site_id,site_name,barter_num,barter_box,barter_product,barter_date,barter_id,barter_name,barter_state,state_time,down_state,down_time,create_time,torder_id)
		values(#{logid},#{order_id},#{barter_type},#{corp_id},#{corp_name},#{site_id},#{site_name},#{barter_num},#{barter_box},#{barter_product},#{barter_date},#{barter_id},#{barter_name},#{barter_state},#{state_time},#{down_state},#{down_time},#{create_time},#{torder_id})
	</insert>
	
	<insert id="update">
		update as_barter_order set corp_name=#{corp_name},site_id=#{site_id},site_name=#{site_name},barter_num=#{barter_num},barter_box=#{barter_box},barter_product=#{barter_product},barter_date=#{barter_date},barter_id=#{barter_id},barter_name=#{barter_name},barter_state=#{barter_state},state_time=#{state_time},down_state=#{down_state},down_time=#{down_time},torder_id=#{torder_id}
		where logid=#{logid}
	</insert>
	
	<delete id="delete">
	    delete from as_barter_order where logid=#{logid}
	</delete>
	
</mapper>